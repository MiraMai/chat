<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width">
        <title>Chat-chat-chat</title>
        
        <!-- Latest compiled and minified CSS -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">

<!-- Optional theme -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css" integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp" crossorigin="anonymous">

<!-- Latest compiled and minified JavaScript -->
<script src="https://code.jquery.com/jquery-3.1.1.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

<script>
    window.addEventListener('load', function() { // Windows load
        
        var usernameInput = document.getElementById('username');
        let loginbtn = document.getElementById('loginbtn');
        let logoutbtn = document.getElementById('logoutbtn');
        let welcome = document.getElementById('welcome');
        let message = document.getElementById('message');
        let send = document.getElementById('send');
        logoutbtn.style.display = "none";
        message.style.display = "none";
        send.style.display = "none";
        

        loginbtn.addEventListener('click', function(){            
        
                localStorage.setItem('username', usernameInput.value);
                console.log(localStorage.getItem('username'));
                welcome.innerHTML = "Welcome " + usernameInput.value + " :)";
                usernameInput.style.display = "none";
                loginbtn.style.display = "none";
                logoutbtn.style.display = "inline";
                message.style.display = "inline";
                send.style.display = "inline";
            
        });
        
        logoutbtn.addEventListener('click', function() {
            
                localStorage.removeItem("username");
                console.log(localStorage.getItem('username'));
                welcome.innerHTML = "";
                usernameInput.style.display = "inline";
                loginbtn.style.display = "inline";
                logoutbtn.style.display = "none";
                chat.style.display = "none";
                message.style.display = "none";
                send.style.display = "none";
        
                window.location.reload();             
            
        });
        
        


  
 //   }
        
    }); // Window load    
        
</script>
    
        <style>
        
            td:first-child {
                font-family: Arial, Helvetica, sans-serif;
/*                font-weight: bold;*/
                font-size: 13pt; 
                background-color: #f5f5ef;
                
            }
            
            td:nth-child(2) {
               font-family: "Comic Sans MS", cursive, sans-serif;
               font-size: 14pt;                
            }
            
            td:nth-child(3) {
                font-family: "Lucida Console", Monaco, monospace;
                font-size: 9pt;
                color: #afaf83;

            }
            
            table {
                margin-top: 100px;
            }
        
        
        </style>
        
        
    </head>
    
    <body>
      <div class="container">
        <div class="row">
           <div class="col-sm-12 text-center"><h1>Welcome to chat-chat-chat!</h1></div>  
        </div>
        <br>
        <br>
        <br>
        <div class="row">
          <div class="col-xs-2 col-sm-4"></div>
          <div class="col-xs-8 col-sm-4">
            
                <div class="form-group">
                    <input type="username" class="form-control" id="username" placeholder="Username">
                </div>
                <button type="login" class="btn btn-default" id="loginbtn">Login</button>
              
          </div>
          <div class="col-xs-2 col-sm-4"></div>    
        </div>
        <div class="row">
          <div class="col-sm-12 text-center">
              <button type="logout" class="btn btn-default" id="logoutbtn">Logout</button>
          </div>
        </div>  
          
        <div class="row">
            <div class="col-sm-12 text-center"><h2 id="welcome"></h2></div>
        </div>
          <br>
          <br>
        <div class="row">
            <div class="col-sm-3"></div>
             <div class="col-sm-6">
                  <textarea class="form-control" rows="5" id="message" placeholder="Write your message here.."></textarea>
                  <button type="send" class="btn btn-default" id="send">Send</button>
                </div>
            <div class="col-sm-3"></div>
          </div>  
          
          <div class="row">
            <div class="col-sm-3"></div>  
            <div class="col-sm-6">
                <table class="table table-hover">
                   <tbody id="chat">
                       <tr>
                       </tr>
                    </tbody>
                </table>
              </div>
            <div class="col-sm-3"></div>  
          </div>
      </div>   
        
    <!--********************** firebase***************************-->
        
<script src="https://www.gstatic.com/firebasejs/3.7.2/firebase.js"></script>
<script>
  // Initialize Firebase
  var config = {
    apiKey: "AIzaSyDswQw1vBTEt9Asf_EeNl4pFbJdUs4xt1Q",
    authDomain: "chat-chat-chat-e26df.firebaseapp.com",
    databaseURL: "https://chat-chat-chat-e26df.firebaseio.com",
    storageBucket: "chat-chat-chat-e26df.appspot.com",
    messagingSenderId: "345910730022"
  };
  firebase.initializeApp(config);
</script>
<!--****************************************************************        -->    
    
    <script type="text/javascript">      
        
            window.addEventListener('load', function() { // Windows load
                
// date function                
      var currentDate = new Date(),
      day = currentDate.getDate(),
      month = currentDate.getMonth() + 1,
      year = currentDate.getFullYear();

// time function                
      var currentTime = new Date(),
      hours = currentTime.getHours(),
      minutes = currentTime.getMinutes();

	if (minutes < 10) {
	 minutes = "0" + minutes;
  }
                
                
                
                var usernameInput = document.getElementById('username');

                
                
                let message = document.getElementById('message');
                let chat = document.getElementById('chat');
                let sendbtn = document.getElementById('send');
                let tableIntoList = [];
                
                
         // gör så att table blir en array              
                let makeTableIntoArray = function() {
                for ( var j = 1; j < chat.rows.length; j++ ) {
                    tableIntoList.push ({
                        name: chat.rows[j].cells[0],
                        message : chat.rows[j].cells[1],
                        time: chat.rows[j].cells[2]
                    });
//                    console.log(tableIntoList.length);
//                    console.log(tableIntoList);
                } 
                }
//                                        console.log(tableIntoList.length);

                
                
                sendbtn.addEventListener('click', function(meddelande){
                    
            //***********************************
            //*******************************
                     
                    chat.innerHTML = "";
                  firebase.database().ref('inputMessage/' /*+ usernameInput.value*/).push({
					    name: usernameInput.value,
                        message: message.value,
                        time: hours + ":" + minutes + ",   " + day + "/" + month + "/" + year,
                        id: tableIntoList.indexOf()
                })
                    message.value = "";

                });
    
//                    console.log(tableIntoList.length);

 // show firebase content 


        loginbtn.addEventListener('click', function(){          
            

             firebase.database().ref('inputMessage/').on('value', function(snapshot) {
                    let dataObject = snapshot.val();
                    for (let i in dataObject) {
                        
//                        console.log(dataObject);
//                        console.log(dataObject[i].message);
                    
                        
                        let tr = document.createElement('tr');
                        let tdName = document.createElement('td');
                        let tdMessage = document.createElement('td');
                        let tdTime = document.createElement('td');

                        tdName.innerHTML = dataObject[i].name+ ":";
                        tdMessage.innerHTML = dataObject[i].message;
                        tdTime.innerHTML = dataObject[i].time;
                        
//                        console.log(dataObject.message);
                        
                        
           //             tr.innerHTML = dataObject[i].message + ", " + dataObject[i].name + ", " + dataObject[i].time;
                        
       //                 chat.appendChild(tr);
                        chat.insertBefore(tr, chat.firstChild);

                        tr.appendChild(tdName);
                        tr.appendChild(tdMessage);
                        tr.appendChild(tdTime);
                        
                       // list.insertBefore(newItem, list.childNodes[0]); 

                        
        
                                            }
                        makeTableIntoArray();
                        tableIntoList.reverse();
                 
                      

                    console.log(dataObject);
                    console.log(tableIntoList.length);
                    console.log(tableIntoList.indexOf(1));
                    console.log(tableIntoList.indexOf(2));
 //                   console.log(tableIntoList.reverse());
                    console.log(tableIntoList);
//                        console.log(tableIntoList.length);

                                       
                })
                
        });
                
                        
   
            
                     
                
                
            }); // Windows load
        
        </script>
        
    </body>
    



</html>
